# demo01 - ä¸€ä¸ªç®€å•çš„ demo

å‰é¢ç®€å•åœ°è®²è¿°äº† `webpack` çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢å¼€å§‹å®æˆ˜æ¥å¼ºåŒ–è¿™äº›æ¦‚å¿µã€‚

è¿™é‡Œå†å¼ºè°ƒä¸€æ¬¡ï¼Œç¬”è®°å’Œç¤ºä¾‹æ˜¯ç”¨ macOS åšç¤ºä¾‹çš„ï¼Œè¯·ä¸è¦æ— è„‘è·Ÿåšã€‚

é¦–å…ˆå®‰è£… [nvm](https://github.com/nvm-sh/nvm)ã€‚nvm æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† node ç‰ˆæœ¬çš„å·¥å…·ã€‚

```shell
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash
```

å¦‚æœä½ å·²ç»å®‰è£…äº† nodeï¼Œä½ ä¹Ÿå¯ä»¥è€ƒè™‘å®Œå…¨å¸è½½ node ä¹‹åå®‰è£… nvmã€‚å¦‚æœä¸éœ€è¦é¢‘ç¹æ›´æ¢ node ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥å®‰è£… nodeã€‚

å®‰è£… nvm ä¹‹åï¼Œä½¿ç”¨ nvm æ¥å®‰è£… node v14ã€‚

```shell
nvm install 14
```

æ–°å»ºä¸€ä¸ª `demo` æ–‡ä»¶å¤¹ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç”¨ `npm` åˆå§‹åŒ–ï¼Œè¿™ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ `package.json` æ–‡ä»¶ã€‚

```shell
mkdir demo # æ–°å»ºä¸€ä¸ª demo æ–‡ä»¶å¤¹
cd demo # è¿›å…¥è¯¥æ–‡ä»¶å¤¹
npm init -y # npm åˆå§‹åŒ–
```

æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `.npmrc` æ–‡ä»¶ç”¨æ¥é…ç½® `npm`ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šä¾èµ–æºæ˜¯å›½å†…çš„æ·˜å®æºï¼Œè¿™æ ·å®‰è£…ä¾èµ–çš„é€Ÿåº¦ä¼šæ›´å¿«ä¸€ç‚¹ã€‚

```shell
registry=https://registry.npmmirror.com/
chromedriver_cdnurl=https://npmmirror.com/mirrors/chromedriver/
electron_builder_binaries_mirror=https://npmmirror.com/mirrors/electron-builder-binaries/
electron_mirror=https://npmmirror.com/mirrors/electron/
fsevents_binary_host_mirror=http://npmmirror.com/mirrors/fsevents/
node_inspector_cdnurl=https://npmmirror.com/mirrors/node-inspector/
phantomjs_cdnurl=https://npmmirror.com/mirrors/phantomjs/
sass_binary_site=https://npmmirror.com/mirrors/node-sass/
selenium_cdnurl=https://npmmirror.com/mirrors/selenium/

```

ç„¶åå®‰è£…ç›¸å…³ä¾èµ–ã€‚

```shell
npm i clean-webpack-plugin@~3.0.0 -D
npm i copy-webpack-plugin@~6.4.1 -D
npm i friendly-errors-webpack-plugin@~1.7.0 -D
npm i html-webpack-plugin@~4.5.2 -D
npm i webpack@~4.46.0 -D
npm i webpack-cli@~4.7.2 -D
```

åˆ›å»ºä¸€ä¸ªå†…å®¹ç®€å•çš„ `${PROJECT_DIR}/src/index.js`ã€‚

```javascript
document.write('Hello webpack!');
```

åˆ›å»ºä¸€ä¸ª `webpack` é…ç½®æ–‡ä»¶ `${PROJECT_DIR}/webpack.config.js`ã€‚ä¸ç‰¹æ„æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œ`webpack` ä¼šé»˜è®¤ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚

```javascript
// ä½¿ç”¨ path æ¨¡å—æ¥æŒ‡å®šè·¯å¾„
const path = require('path');

module.exports = {
  // æŒ‡å®š mode
  mode: 'production',
  // æŒ‡å®š entry
  entry: path.resolve('src', 'index.js'),
  // æŒ‡å®š output
  output: {
    path: path.resolve('dist'),
    filename: 'bundle.js',
  },
};
```

æˆ‘ä»¬å†æ¥ä¿®æ”¹ `package.json` é‡Œé¢çš„ `scripts` å­—æ®µã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡ `webpack-cli` æä¾›çš„å‘½ä»¤è°ƒç”¨ `webpack` æ„å»ºã€‚

```json
{
  ...,
  "scripts": {
    "build": "webpack"
  },
  ...
}
```

æ¥ç€ï¼Œå°±æ‰§è¡Œå‘½ä»¤å¼€å§‹æ„å»ºå§ã€‚

```shell
npm run build
```

æ„å»ºç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ `dist` æ–‡ä»¶å¤¹é‡Œé¢ä¼šå‡ºç°ä¸€ä¸ª `bundle.js` æ–‡ä»¶ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª `.html` æ–‡ä»¶ç„¶åå¼•ç”¨å®ƒï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚

å®é™…å¼€å‘çš„æ—¶å€™ï¼Œæ¯æ¬¡æ„å»ºä¹‹åéƒ½è€—è´¹æ—¶é—´å»åšè¿™æ ·çš„é‡å¤å·¥ä½œæ˜¯éš¾ä»¥å¿å—çš„ã€‚æˆ‘ä»¬éœ€è¦ä¸€äº›è‡ªåŠ¨å¤„ç†çš„æ‰‹æ®µï¼Œæ¥å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ `.html` æ–‡ä»¶å¹¶å¼•ç”¨è¿™ä¸ª `bundle.js` æ–‡ä»¶ã€‚

é¡¹ç›®æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª `public` æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾ `favicon.ico`ï¼ˆå¯ä»¥è‡ªå·±éšä¾¿æ‰¾ä¸€ä¸ªï¼Œæˆ–è€…æŠŠä½ ç°åœ¨æœ‰çš„å›¾ç‰‡è½¬æˆ ico æ ¼å¼ï¼‰å’Œ `index.html`ã€‚

`index.html` é‡Œé¢çš„å†…å®¹åˆ—å‡ºåœ¨ä¸‹é¢ã€‚æˆ‘ä»¬åœ¨ L7 å¼•ç”¨äº† `favicon.ico` ä½œä¸ºç½‘ç«™å›¾æ ‡ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link href="favicon.ico" type="image/x-icon" />
    <title>demo01</title>
  </head>
  <body></body>
</html>
```

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ `${PROJECT_DIR}/webpack.config.js` é‡Œé…ç½®ï¼Œè®© `copy-webpack-plugin` æ¥å¤„ç†ç½‘ç«™å›¾æ ‡ï¼Œè®© `html-webpack-plugin` å¤„ç† `.html` æ–‡ä»¶é‡Œçš„å¼•ç”¨ã€‚

```javascript
const CopyPlugin = require('copy-webpack-plugin');
const HtmlPlugin = require('html-webpack-plugin');

module.exports = {
  ...
  // æŒ‡å®š entry
  entry: path.resolve('src', 'index.js'),
  // æŒ‡å®š output
  output: {
    path: path.resolve('dist'),
    filename: 'bundle.js',
  },
  plugins: [
    // å¤åˆ¶ ${PROJECT_DIR}/public/favicon.ico
    // æœ€ç»ˆç”Ÿæˆ ${PROJECT_DIR}/dist/favicon.ico
    new CopyPlugin({
      patterns: [{ from: path.resolve('public', 'favicon.ico') }],
    }),
    // ä½¿ç”¨ ${PROJECT_DIR}/public/index.html ä½œä¸ºæ¨¡æ¿
    // æœ€ç»ˆç”Ÿæˆ ${PROJECT_DIR}/dist/index.html
    new HtmlPlugin({
      title: 'demo01',
      template: path.resolve('public', 'index.html'),
    }),
  ],
  ...
};

```

- `copy-webpack-plugin` ä¼šæŠŠ `favicon.ico` å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ä¸‹ï¼ˆåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œè¾“å‡ºç›®å½•å°±æ˜¯ `${PROJECT_DIR}/dist`ï¼‰ä½œä¸ºç½‘ç«™å›¾æ ‡ã€‚
- `html-webpack-plugin` ä¼šä½¿ç”¨ `${PROJECT_DIR}/public/index.html` ä½œä¸ºæ‰¿è½½ `bundle.js` å’Œ `favicon.ico` çš„æ¨¡æ¿ï¼Œæœ€ç»ˆä¼šç”Ÿæˆ `${PROJECT_DIR}/dist/index.html`ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè‡ªåŠ¨å¼•ç”¨ç›¸å…³çš„ `.js` æ–‡ä»¶ã€‚

é‡æ–°æ„å»ºï¼Œæ„å»ºç»“æŸä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç° `${PROJECT_DIR}/dist` é‡Œé¢å‡ºç°äº†ä¸‰ä¸ªæ–‡ä»¶ï¼š`favicon.ico`ï¼Œ`index.html` å’Œ `bundle.js`ï¼Œè€Œ `index.html` ä¸­è¿˜è‡ªåŠ¨å¼•ç”¨äº† `bundle.js`ã€‚

ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œä½†ä¸èƒ½å¿½è§†çš„æ˜¯ï¼Œæ¯æ¬¡æ„å»ºä¹‹å‰éƒ½åº”è¯¥åˆ é™¤ä¸Šä¸€æ¬¡çš„æ„å»ºåŒ…ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤ `${PROJECT_DIR}/dist`ã€‚ç›®å‰ä¸åˆ é™¤ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œä½†ä»¥åæ„å»ºå‡ºæ¥çš„æ–‡ä»¶è¶Šæ¥è¶Šå¤šï¼Œä¸åˆ é™¤å¯èƒ½ä¼šå¯¼è‡´æ–°æ—§æ„å»ºå†²çªã€`${PROJECT_DIR}/dist` è¶Šæ¥è¶Šå¤§ã€`${PROJECT_DIR}/dist` é‡Œé¢çš„æ–‡ä»¶è¶Šæ¥è¶Šå¤šç­‰é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `clean-webpack-plugin` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé»˜è®¤åœ°ï¼Œ`clean-webpack-plugin` ä¼šæ ¹æ® `output.path` è‡ªåŠ¨ç¡®è®¤ã€åˆ é™¤ä¸Šä¸€æ¬¡æ„å»ºçš„ç»“æœã€‚

```javascript
const { CleanWebpackPlugin: CleanPlugin } = require('clean-webpack-plugin');

module.exports = {
  ...
  plugins: [
    // ç§»é™¤ä¸Šä¸€æ¬¡çš„æ„å»ºæ–‡ä»¶
    new CleanPlugin(),
    ...
  ],
  ...
};

```

å¦‚æœæ„å»ºå‡ºç°äº†é—®é¢˜ï¼Œ`webpack` ä¼šè¾“å‡ºä¸€é•¿ä¸²é”™è¯¯ä¿¡æ¯ï¼Œä½¿ç”¨ `friendly-errors-webpack-plugin` å¯ä»¥è®©è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯æ›´åŠ å‹å¥½ã€‚

```javascript
const FriendlyErrorsPlugin = require('friendly-errors-webpack-plugin');

module.exports = {
  ...
  plugins: [
    // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
    new FriendlyErrorsPlugin(),
    ...
  ],
  ...
};

```

å®Œæ•´çš„ `webpack.config.js` ä»£ç åˆ—å†™åœ¨ä¸‹é¢ã€‚

```javascript
// ä½¿ç”¨ path æ¨¡å—æ¥æŒ‡å®šè·¯å¾„
const path = require('path');
// ä½¿ç”¨ plugin
const { CleanWebpackPlugin: CleanPlugin } = require("clean-webpack-plugin');
const CopyPlugin = require('copy-webpack-plugin');
const HtmlPlugin = require('html-webpack-plugin');
const FriendlyErrorsPlugin = require('friendly-errors-webpack-plugin');

module.exports = {
  // æŒ‡å®š mode
  mode: 'production',
  // æŒ‡å®š entry
  entry: path.resolve('src', 'index.js'),
  // æŒ‡å®š output
  output: {
    path: path.resolve('dist'),
    filename: 'bundle.js',
  },
  // æŒ‡å®š plugin
  plugins: [
    // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
    new FriendlyErrorsPlugin(),
    // ç§»é™¤ä¸Šä¸€æ¬¡çš„æ„å»ºæ–‡ä»¶
    new CleanPlugin(),
    // å¤åˆ¶ ${PROJECT_DIR}/public/favicon.ico
    // æœ€ç»ˆç”Ÿæˆ ${PROJECT_DIR}/dist/favicon.ico
    new CopyPlugin({
      patterns: [{ from: path.resolve('public', 'favicon.ico') }],
    }),
    // ä½¿ç”¨ ${PROJECT_DIR}/public/index.html ä½œä¸ºæ¨¡æ¿
    // æœ€ç»ˆç”Ÿæˆ ${PROJECT_DIR}/dist/index.html
    new HtmlPlugin({
      title: 'demo01',
      template: path.resolve('public', 'index.html'),
    }),
  ],
};

```

é‡æ–°å¼€å§‹æ„å»ºï¼Œä¹‹åå¯ä»¥çœ‹åˆ°ç®€çŸ­çš„æç¤ºä¿¡æ¯ã€‚ä¸‹é¢æ˜¯æœ€ç»ˆçš„ç›®å½•ç»“æ„ï¼ˆçœç•¥äº†`node_modules`ï¼‰ã€‚

```shell
.
â”œâ”€â”€ dist
â”‚   â”œâ”€â”€ bundle.js
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ src
â”‚   â””â”€â”€ index.js
â””â”€â”€ webpack.config.js
```

ä½¿ç”¨ `live server` æˆ– `serve` æ¥æŸ¥çœ‹æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ° `Hello webpack!`ã€‚

ğŸ‰ æ­å–œï¼Œä¸€ä¸ªç®€å•çš„ webpack demo å·²ç»å®Œæˆå•¦ï½

å‚è€ƒæºä»£ç è§ [modyqyw/webpack4-demos/demo01](https://github.com/ModyQyW/webpack4-demos/tree/master/demo01)ã€‚
